// 格式化Markdown文本的空格，使其符合标准语法规则
export function formatMarkdownSpacing(text) {
  return (
    text
      // 处理标题语法（# 后加空格）
      .replace(/^(#{1,6})(?!#)(\S)/gm, "$1 $2")
      // 处理无序列表（*, -, + 后加空格）
      .replace(/^(\s*)([-+*])(\S)/gm, "$1$2 $3")
      // 处理有序列表（数字. 后加空格）
      .replace(/^(\s*\d+)\.(\S)/gm, "$1. $2")
      // 处理引用块（> 后加空格）
      .replace(/^(\s*>+)(\S)/gm, "$1 $2")
      // 处理代码块（``` 后加空行）
      .replace(/^```([\s\S]*?)```/gm, (match, code) => {
        return `\`\`\`\n${code.trim()}\n\`\`\``;
      })
      // 处理内联代码（` 后加空格，除非紧接着另一个反引号）
      .replace(/(`)([^\s`]+)(`)(?!\s*`)/g, "$1 $2 $3")
      // 处理链接（[链接文本](URL) 中链接文本和URL后加空格）
      .replace(/\[([^\s\]]+)\]\(([^\s)]+)\)/g, "[ $1 ]($2 )")
      // 处理图片（![图片描述](URL) 中图片描述和URL后加空格）
      .replace(/!\[([^\s\]]+)\]\(([^\s)]+)\)/g, "![ $1 ]($2 )")
      // 处理表格（| 分隔符后加空格）
      .replace(/^(\|[^\n]*?\|)(\S)/gm, "$1 $2")
      // 处理表格对齐（: 后加空格）
      .replace(/(?<!\|):(\S)/g, ": $1")
  );
}
